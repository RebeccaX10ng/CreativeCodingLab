<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>DAYS Records Archive</title>
  <link rel="stylesheet" href="css/style.css">

  <script src="js/lib/p5.js"></script>
  <script src="js/lib/p5.sound.js"></script>
  <!-- //embed a font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sedan:ital@0;1&display=swap" rel="stylesheet">
  <!-- <script src="js/musicNotes.js"></script> -->
</head>

<body class="no-vertical-scroll">


  </div>
  <div id="sideMenuBtn">&#9776;</div>
  <nav id="sideMenu" class="side-menu">
    <div class="side-menu-categories">
      <a href="#" class="side-menu-link">Public Gallery</a>
      <a href="#" id="myCollectionsLink" class="side-menu-link">My Collections</a>
      <a href="select_a_template.html" class="side-menu-link">Create My Record</a>
    </div>
    <div id="authContainer" class="side-menu-bottom">
      <a href="#" class="side-menu-signin">Sign In</a>
    </div>
  </nav>
  <h1 class="title">
    <span class="titleItalic">DAYS</span> <span class="titleNormal">Records Archive</span>
  </h1>
  <div id="fullScreenContainer"></div>
  <!-- <div><a href="https://www.google.com/">go to google</a></div> -->
  <!-- <div id="canvasContainer">
    p5 canvas will be appended here!
  </div> -->

  <a href="select_a_template.html">
    <div class="newAlbum">
      <div id="addMark">+</div>

      <p>Create My Own Album! </p>
    </div>
  </a>
  <!-- <script src="js/script.js"></script> -->
  <script src="js/musicNotes.js"></script>
  <script>
    const menuBtn = document.getElementById('sideMenuBtn');
    const sideMenu = document.getElementById('sideMenu');
    menuBtn.onclick = () => {
      sideMenu.classList.toggle('open');
    };
    document.addEventListener('click', (e) => {
      if (!sideMenu.contains(e.target) && e.target !== menuBtn) {
        sideMenu.classList.remove('open');
      }
    });
  </script>

  <script type="module">
    // 1. 从 SDK 导入所有需要的功能
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    // 2. 您的项目配置
    const firebaseConfig = {
      apiKey: "AIzaSyBOTjmMPnN16vh6zd6TQ3MVV1I1fqCpQ2U",
      authDomain: "days-records.firebaseapp.com",
      projectId: "days-records",
      storageBucket: "days-records.firebasestorage.app",
      messagingSenderId: "454621890868",
      appId: "1:454621890868:web:9095c79739212ca4e3bd61",
      measurementId: "G-7ZKGPTRHPP"
    };

    // 3. 【【【 只在这里初始化一次 App 】】】
    const app = initializeApp(firebaseConfig);

    // 4. 从这一个 app 实例初始化所有需要的服务
    const analytics = getAnalytics(app);
    const auth = getAuth(app);

    // 5. 监听用户登录状态变化
    onAuthStateChanged(auth, (user) => {
      const authContainer = document.getElementById('authContainer');
      const myCollectionsLink = document.getElementById('myCollectionsLink');

      if (user) {
        // 用户已登录
        authContainer.innerHTML = `
        <div class="side-menu-user">
          <p>Welcome, ${user.displayName.split(' ')[0]}!</p>
          <a href="#" id="signOutBtn" class="side-menu-signin">Sign Out</a>
        </div>
      `;
        document.getElementById('signOutBtn').addEventListener('click', (e) => {
          e.preventDefault();
          signOut(auth);
        });
        myCollectionsLink.href = 'my-creations.html';
      } else {
        // 用户未登录
        authContainer.innerHTML = `
        <a href="#" id="signInBtn" class="side-menu-signin">Sign In</a>
      `;
        document.getElementById('signInBtn').addEventListener('click', (e) => {
          e.preventDefault();
          const provider = new GoogleAuthProvider();
          signInWithPopup(auth, provider).catch(error => console.error(error));
        });
        myCollectionsLink.href = '#';
      }
    });

    console.log("Firebase initialized successfully (once):", app);
  </script>
</body>

</html>